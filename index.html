<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TANTI AUGURI AMORE MIO ❤️</title>
  <meta name="theme-color" content="#FFFBE2" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#FFFBE2;--ink:#C21807;--card:#FFFAD1;--shadow:0 8px 24px rgba(0,0,0,.08);--radius:16px}
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;line-height:1.6}
    .hero{position:relative;padding:64px 16px 40px;text-align:center}
    h1{font-size:clamp(32px,5vw,56px);margin-bottom:6px}
    .subtitle{font-family:"Dancing Script",cursive;font-size:clamp(22px,3.2vw,34px);font-weight:700;margin-bottom:24px}
    #confetti{position:absolute;inset:0;width:100%;height:100%;pointer-events:none}
    .cta{display:grid;justify-items:center;gap:12px;margin-top:18px}
    .cta small{font-size:13px;opacity:.9;text-transform:uppercase;letter-spacing:.5px}
    /* Bottone immagine (niente SVG) */
    .gift-btn{
      border:0;background:transparent;cursor:pointer;
      width:clamp(140px,22vw,200px);aspect-ratio:1/1;border-radius:12px;
      transition:transform .25s ease
    }
    .gift-btn:hover{transform:translateY(-4px) scale(1.05)}
    .gift-btn img{display:block;width:100%;height:100%;object-fit:contain;border-radius:12px}
    main{max-width:1000px;margin:0 auto;padding:24px 16px 56px}
    section{margin:24px 0;background:rgba(255,255,255,.5);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
    h2{text-align:center;margin-bottom:8px}
    .vouchers[hidden]{display:none}
    .vouchers{opacity:0;transform:translateY(10px);transition:opacity .28s ease,transform .28s ease}
    .vouchers.reveal{opacity:1;transform:translateY(0)}
    .vouchers-header p{margin:6px auto 16px;font-size:14px;max-width:800px;text-align:center}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
    .voucher{background:var(--card);border:1px dashed rgba(194,24,7,.55);border-radius:14px;padding:14px;min-height:150px;display:flex;flex-direction:column;gap:10px}
    .voucher-title{font-weight:800;text-transform:uppercase}
    .voucher-body{font-style:italic}
    .voucher-meta{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .redeemBtn{padding:6px 10px;border-radius:999px;border:1px solid rgba(194,24,7,.35);background:rgba(194,24,7,.08);color:var(--ink);cursor:pointer;font-size:12px}
    .voucher[data-redeemed="true"]{opacity:.88;border-style:solid}
    .date-badge{font-size:11px;padding:4px 8px;border-radius:999px;background:rgba(194,24,7,.08);border:1px solid rgba(194,24,7,.25)}
    @media print{body{background:#fff;color:#000}.hero{display:none}section{box-shadow:none;background:#fff}.redeemBtn{display:none}}
  </style>
</head>
<body>
  <header class="hero">
    <h1>TANTI AUGURI AMORE MIO ❤️</h1>
    <p class="subtitle">A special gift just for you</p>

    <div class="cta">
      <small>CLICCA PER SPACCHETTARE IL TUO REGALO</small>

      <!-- SOLO IMMAGINE (trasparente) -->
      <button id="openGift" class="gift-btn" aria-controls="vouchers" aria-expanded="false" aria-label="Apri il regalo">
        <img
          src="https://pngimg.com/uploads/gift/gift_PNG100465.png?v=5"
          alt="Pacchetto regalo"
          loading="eager" decoding="async"
          onerror="this.onerror=null;this.src='https://pngimg.com/uploads/gift/gift_PNG100448.png?v=5';"
        >
      </button>
    </div>

    <canvas id="confetti"></canvas>
  </header>

  <main>
    <section id="vouchers" class="vouchers" hidden>
      <div class="vouchers-header">
        <h2>LOVE VOUCHERS</h2>
        <p><strong>Avvertenze:</strong> Questi voucher potrebbero causare dipendenza affettiva e dolcezza eccessiva. Scadenza: illimitata.</p>
      </div>

      <div class="grid" id="voucherGrid">
        <article class="voucher" data-idx="1"><h3 class="voucher-title">GRATTINI</h3><p class="voucher-body">Sessione di 30 minuti di grattini a scelta.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="2"><h3 class="voucher-title">MASSAGGIO RILASSANTE</h3><p class="voucher-body">Massaggio rilassante completo della durata di 60 minuti.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="3"><h3 class="voucher-title">SERATA FILM</h3><p class="voucher-body">Film a scelta con snack o cena sul divano.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="4"><h3 class="voucher-title">COMANDI TU</h3><p class="voucher-body">Per una giornata intera si farà tutto ciò che desideri.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="5"><h3 class="voucher-title">COLAZIONE A LETTO</h3><p class="voucher-body">Colazione a scelta servita a letto (prenotare in anticipo!).</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="6"><h3 class="voucher-title">CHEF PERSONALE</h3><p class="voucher-body">Cena a scelta preparata dal partner, dalla spesa alla pulizia.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="7"><h3 class="voucher-title">FANTASIA PICCANTE</h3><p class="voucher-body">Realizzazione di una fantasia a scelta del partner.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="8"><h3 class="voucher-title">BOCCONOTTO NOW</h3><p class="voucher-body">Diritto a ricevere subito un bocconotto.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="9"><h3 class="voucher-title">GAME NIGHT</h3><p class="voucher-body">Serata di giochi a scelta: da tavolo, online o bowling.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="10"><h3 class="voucher-title">CINEMA</h3><p class="voucher-body">Serata cinema con film a scelta, tutto offerto.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="11"><h3 class="voucher-title">GELATINO</h3><p class="voucher-body">Un gelato a scelta in qualsiasi momento.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="12"><h3 class="voucher-title">BOOK LOVER</h3><p class="voucher-body">Ricevi un libro a scelta in regalo.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
        <article class="voucher" data-idx="13"><h3 class="voucher-title">CIOCCOLATINO</h3><p class="voucher-body">Un cioccolatino a scelta in qualsiasi momento.</p><div class="voucher-meta"><button class="redeemBtn">Riscatta</button><div class="meta-right"></div></div></article>
      </div>
    </section>
  </main>

  <script>
    /* Apertura regalo */
    function openGift(){
      const sec=document.getElementById("vouchers");
      sec.hidden=false; void sec.offsetHeight;
      sec.classList.add("reveal");
      document.getElementById("openGift").setAttribute("aria-expanded","true");
      sec.scrollIntoView({behavior:"smooth",block:"start"});
      burstConfetti();
    }
    document.addEventListener("DOMContentLoaded",()=>{
      document.getElementById("openGift").addEventListener("click",openGift);
      loadState();
      startConfetti();
    });

    /* Utilità data */
    function todayIT(){const d=new Date();return `${String(d.getDate()).padStart(2,"0")}/${String(d.getMonth()+1).padStart(2,"0")}/${d.getFullYear()}`}
    function isValidITDate(str){
      if(!/^\d{2}\/\d{2}\/\d{4}$/.test(str))return false;
      const[dd,mm,yyyy]=str.split("/").map(n=>parseInt(n,10));
      const dt=new Date(yyyy,mm-1,dd);
      return dt.getFullYear()===yyyy&&dt.getMonth()===mm-1&&dt.getDate()===dd;
    }

    /* Stato vouchers */
    function loadState(){
      document.querySelectorAll(".voucher").forEach(v=>{
        const idx=v.dataset.idx;
        const redeemed=localStorage.getItem(`voucher_${idx}_redeemed`)==="1";
        const date=localStorage.getItem(`voucher_${idx}_date`)||"";
        const btn=v.querySelector(".redeemBtn");
        const meta=v.querySelector(".meta-right");
        if(redeemed){
          v.dataset.redeemed="true";
          if(btn) btn.textContent="Riscattato";
          if(date) meta.innerHTML=`<span class="date-badge">Riscattato il: ${date}</span>`;
        }
      });
    }

    document.addEventListener("click",(e)=>{
      if(!e.target.classList.contains("redeemBtn")) return;
      const card=e.target.closest(".voucher");
      const idx=card.dataset.idx;
      const meta=card.querySelector(".meta-right");
      if(card.dataset.redeemed==="true") return;
      let date=prompt("Inserisci la data di riscatto (GG/MM/AAAA):", todayIT());
      if(!date) return;
      if(!isValidITDate(date)){ alert("Formato non valido. Usa GG/MM/AAAA."); return; }
      card.dataset.redeemed="true";
      e.target.textContent="Riscattato";
      localStorage.setItem(`voucher_${idx}_redeemed`,"1");
      localStorage.setItem(`voucher_${idx}_date`,date);
      meta.innerHTML=`<span class="date-badge">Riscattato il: ${date}</span>`;
    });

    /* Confetti */
    let confettiCanvas, ctx, confettiPieces=[];
    function startConfetti(){
      confettiCanvas=document.getElementById("confetti");
      if(!confettiCanvas) return;
      ctx=confettiCanvas.getContext("2d");
      resizeConfetti(); window.addEventListener("resize", resizeConfetti);
      confettiPieces=Array.from({length:100},()=>spawnPiece(true));
      animateConfetti();
    }
    function resizeConfetti(){confettiCanvas.width=confettiCanvas.offsetWidth;confettiCanvas.height=confettiCanvas.offsetHeight}
    function spawnPiece(topRandom=false){
      const w=confettiCanvas.width,h=confettiCanvas.height;
      return{x:Math.random()*w,y:topRandom?Math.random()*-h:-10,r:4+Math.random()*6,d:1+Math.random()*2,t:Math.random()*Math.PI};
    }
    function animateConfetti(){
      ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
      for(const p of confettiPieces){
        ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.t);
        ctx.fillStyle=Math.random()>.5?"#C21807":"#E64747";
        ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r*.6);
        ctx.restore();
        p.y+=p.d;p.x+=Math.sin(p.y/25)*.8;p.t+=.02;
        if(p.y>confettiCanvas.height+20){p.y=-10;p.x=Math.random()*confettiCanvas.width;}
      }
      requestAnimationFrame(animateConfetti);
    }
    function burstConfetti(){
      if(!confettiCanvas)return;
      for(let i=0;i<60;i++) confettiPieces.push(spawnPiece(false));
      if(confettiPieces.length>240) confettiPieces=confettiPieces.slice(-240);
    }
  </script>
</body>
</html>
